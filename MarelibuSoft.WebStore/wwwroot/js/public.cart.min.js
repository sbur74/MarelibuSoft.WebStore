function addQuantity(n,t,i){var f=n,u=$("#"+f+"_quantity"),r=marelibusoft.common.str2Float(u.val()),e=marelibusoft.common.str2Float(t);e<1?r+=.1:r++;r=marelibusoft.common.float2LocalString(r);u.val(r);quantityPrice(n,i)}function subQuantity(n,t,i){var o=n,f=$("#"+o+"_quantity"),r=marelibusoft.common.str2Float(f.val()),u=r,e=marelibusoft.common.str2Float(t);e<1?u-=.1:u--;u>=e&&(r=u);r=marelibusoft.common.float2LocalString(r);f.val(r);quantityPrice(n,i)}function quantityPrice(n,t){var r=$("#"+n+"_quantityPrice"),u=marelibusoft.common.str2Float($("#"+n+"_quantity").val()),f=marelibusoft.common.str2Float(t),e=f*u,i=marelibusoft.common.float2LocalCurrencyString(e);i+="&nbsp;<b>*<\/b>";r.html(i)}function postCartLine(n,t,i){var r=n,v=t,o=$("#"+r+"_quantity"),f=o.val(),s,e,u,h,c,l,a;f=f.replace(",",".");s=i.replace(",",".");e=parseFloat(s);e=marelibusoft.common.str2Float(i);u=parseFloat(f);u=marelibusoft.common.str2Float($("#"+r+"_quantity").val());h=$("#"+r+"_sellActionItemId").val();c="/api/ShoppingCartLines";console.log("postCartLine -> quantity: "+u);l=$("#cartid").html();a=$("input[name='__RequestVerificationToken']").val();r&&checkIsQuantityAvailable(r,r)?$.ajax(c,{type:"POST",headers:{"X-XSRF-TOKEN":a},data:JSON.stringify({shoppingCartID:l,quantity:u,productID:r,unitID:t,sellBasePrice:e,sellActionItemId:h}),success:function(n){console.log(n);getAvailableQuantity(n);$("#cartDisplay").load("/AjaxContent/ShoppingCart");marelibusoft.common.showModalAlert("alert","Erfolgreich angelegt!","success")},error:function(){$("#cartDisplay").load("/AjaxContent/ShoppingCart");marelibusoft.common.showModalAlert("alert","Bei der Anlage ist ein Fehler aufgetreten!","danger");setTimeout(location.reload(),800)},contentType:"application/json",timeout:6e4}):setTimeout(location.reload(),800);o.val(0)}function updateCartline(n,t,i,r,u,f){var e=n,c=$("#cartid").html(),l="/api/ShoppingCartLines/"+e,o=$("#"+n+"_quantity").val(),a=parseFloat(f.replace(",",".")),h;$("#"+e+"_minus").addClass("disabled");$("#"+e+"_plus").addClass("disabled");document.getElementById(e+"_loader").style.display="block";o=o.replace(",",".");var v=u.replace(",","."),y=parseFloat(v),s=parseFloat(o);if(s<a)return marelibusoft.common.showModalAlert("alertMessage","Die Mimdestabnahme "+f+" "+i+" darf nicht unterschriten werden!","warning"),!1;h=$("input[name='__RequestVerificationToken']").val();e&&checkIsQuantityAvailable(e,r)?$.ajax(l,{type:"PUT",headers:{"X-XSRF-TOKEN":h},data:JSON.stringify({id:n,position:t,unitID:i,productID:r,quantity:s,shoppingCartID:c,sellBasePrice:y}),success:function(n){console.log(n);$("#cartDisplay").load("/AjaxContent/ShoppingCart");updateTotal();location.reload()},error:function(){$("#cartDisplay").load("/AjaxContent/ShoppingCart");marelibusoft.common.showModalAlert("alert","Bei der Anlage ist ein Fehler aufgetreten!","danger");setTimeout(location.reload(),800)},contentType:"application/json",timeout:6e4}):setTimeout(location.reload(),800)}function getAvailableQuantity(n){var i="_availableQuantity",t=n.productid,r=$("input[name='__RequestVerificationToken']").val(),u="/api/Products/"+t;t&&$.ajax(u,{type:"GET",headers:{"X-XSRF-TOKEN":r},success:function(n){console.log(n);var u=$("#"+t+i),r=parseFloat(n.availableQuantity);r=r.toFixed(2);r=r.replace(".",",");u.html(r);n.avquantity<n.minimumPurchaseQuantity&&$("#"+t+"_btnCart").addClass("disabled");$("#cartDisplay").load("/AjaxContent/ShoppingCart")},error:function(n){console.log(n);marelibusoft.common.showModalAlert("alert","Verfügbaremege konnte nicht abgerufen werden!","warning");$("#cartDisplay").load("/AjaxContent/ShoppingCart");setTimeout(location.reload(),800)},contentType:"application/json",dataType:"json",timeout:6e4})}function deleteCartLine(n){var t=n,i=$("#cartid").html(),r="/api/ShoppingCartLines/"+t,u=$("input[name='__RequestVerificationToken']").val();document.getElementById(t+"_loader").style.display="block";$.ajax(r,{type:"DELETE",headers:{"X-XSRF-TOKEN":u},data:JSON.stringify({shoppingCartID:i,id:t}),success:function(n){console.log("on delete cart line: "+n);$("#cartDisplay").load("/AjaxContent/ShoppingCart");location.reload()},error:function(){$("#cartDisplay").load("/AjaxContent/ShoppingCart");marelibusoft.common.showModalAlert("alert","Beim löschen ist ein fehler aufgetreten!","danger");location.reload()},contentType:"application/json",dataType:"json",timeout:6e4})}function creatCart(){var t=$("#cartid").html(),i=$("input[name='__RequestVerificationToken']").val(),n;t||(n="/api/ShoppingCarts",$.ajax(n,{type:"POST",data:JSON.stringify({shoppingCartID:""}),success:function(n){var t=JSON.parse(n),i=$("#cartid").html(t.shoppingCartID);$("#cartCount").html(0)},error:function(){$("#cartDisplay").load("/AjaxContent/ShoppingCart");alert("error on creat cart!")},contentType:"application/json",dataType:"json",timeout:6e4}))}function onShipPriceChange(){var t=$("#total").html(),n,i;t=t.replace(",",".");n=$("#countries").val();n=n.replace(",",".");i=$("#shipPrice").html();i=i.replace(",",".");var r=parseFloat(t),u=parseFloat(i),f=parseFloat(n);r=r-u;r=r+f;r=r.toFixed(2);t=r.toLocaleString();t=t.replace(".",",");u=u.toFixed(2);i=u.toLocaleString();i=i.replace(".",",");f=f.toFixed(2);n=f.toLocaleString();n=n.replace(".",",");$("#shipPrice").html(n);$("#total").html(t)}function updateTotal(){var t=$("#total").html(),n=0,i=$("#shipPrice").html(),r;i=i.replace(",",".");r=parseFloat(i);$(".listprice").each(function(t){var i,r;console.log(t+": "+$(this).html());i=$(this).html();i=i.replace(",",".");r=parseFloat(i);n+=r});n+=r;n=n.toFixed(2);t=n.toLocaleString();t=t.replace(".",",");$("#total").html(t)}function checkIsQuantityAvailable(n,t){var s=$("#"+t+"_availableQuantity"),h=$("#"+n+"_quantity"),i=h.val(),r=s.html(),f=$("#"+n+"_startQuantity").html(),u,e,o;return(i=i.replace(",","."),r=r.replace(",","."),u=parseFloat(i),e=parseFloat(r),f&&(o=parseFloat(f.replace(",",".")),u-=o),u>e)?(marelibusoft.common.showModalAlert("alert","Die die eingegebene Megene &uuml;bersteigt die verf&uuml;gbare Menge!","danger"),!1):!0}if(!marelibusoft)var marelibusoft={};marelibusoft.cart||(marelibusoft.cart={});marelibusoft.cart.changedItems=[];