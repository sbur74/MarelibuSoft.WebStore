function addQuantity(n,t,i){var e=n,f=$("#"+e+"_quantity"),u=f.val();u=u.replace(",",".");var r=parseFloat(u),o=t.replace(",","."),s=parseFloat(o);s<1?r+=.1:r++;r=r.toFixed(2);r=parseFloat(r);r=r.toLocaleString();f.val(r);quantityPrice(n,i)}function subQuantity(n,t,i){var s=n,e=$("#"+s+"_quantity"),f=e.val();f=f.replace(",",".");var r=parseFloat(f),u=r,o=parseFloat(t.replace(",","."));o<1?u-=.1:u--;u>=o&&(r=u);r=r.toFixed(2);r=parseFloat(r);r=r.toLocaleString();e.val(r);quantityPrice(n,i)}function quantityPrice(n,t){var r=$("#"+n+"_quantity").val(),f=$("#"+n+"_quantityPrice");r=r.replace(",",".");t=t.replace(",",".");var e=parseFloat(r),o=parseFloat(t),u=o*e,i=u.toFixed(2);u=parseFloat(i);i=u.toLocaleString();i+=" &euro; <b>*<\/b>";f.html(i)}function postCartLine(n,t,i){var r=n,a=t,f=$("#"+r+"_quantity"),u=f.val(),o,s;u=u.replace(",",".");var h=i.replace(",","."),c=parseFloat(h),e=parseFloat(u),l=$("#"+r+"_sellActionItemId").val();console.log("postCartLine -> quantity: "+e);o=$("#cartid").html();s=$("input[name='__RequestVerificationToken']").val();r&&checkIsQuantityAvailable(r,r)?$.ajax("/api/ShoppingCartLines",{type:"POST",headers:{"X-XSRF-TOKEN":s},data:JSON.stringify({shoppingCartID:o,quantity:e,productID:r,unitID:t,sellBasePrice:c,sellActionItemId:l}),success:function(n){console.log(n);getAvailableQuantity(n);$("#cartDisplay").load("/AjaxContent/ShoppingCart");marelibusoft.common.showModalAlert("alert","Erfolgreich angelegt!","success")},error:function(){$("#cartDisplay").load("/AjaxContent/ShoppingCart");marelibusoft.common.showModalAlert("alert","Bei der Anlage ist ein Fehler aufgetreten!","danger");setTimeout(location.reload(),800)},contentType:"application/json",timeout:6e4}):setTimeout(location.reload(),800);f.val(0)}function updateCartline(n,t,i,r,u,f){var e=n,c=$("#cartid").html(),l="/api/ShoppingCartLines/"+e,o=$("#"+n+"_quantity").val(),a=parseFloat(f.replace(",",".")),h;$("#"+e+"_minus").addClass("disabled");$("#"+e+"_plus").addClass("disabled");document.getElementById(e+"_loader").style.display="block";o=o.replace(",",".");var v=u.replace(",","."),y=parseFloat(v),s=parseFloat(o);if(s<a)return marelibusoft.common.showModalAlert("alertMessage","Die Mimdestabnahme "+f+" "+i+" darf nicht unterschriten werden!","warning"),!1;h=$("input[name='__RequestVerificationToken']").val();e&&checkIsQuantityAvailable(e,r)?$.ajax(l,{type:"PUT",headers:{"X-XSRF-TOKEN":h},data:JSON.stringify({id:n,position:t,unitID:i,productID:r,quantity:s,shoppingCartID:c,sellBasePrice:y}),success:function(n){console.log(n);$("#cartDisplay").load("/AjaxContent/ShoppingCart");updateTotal();location.reload()},error:function(){$("#cartDisplay").load("/AjaxContent/ShoppingCart");marelibusoft.common.showModalAlert("alert","Bei der Anlage ist ein Fehler aufgetreten!","danger");setTimeout(location.reload(),800)},contentType:"application/json",timeout:6e4}):setTimeout(location.reload(),800)}function getAvailableQuantity(n){var i="_availableQuantity",t=n.productid,r=$("input[name='__RequestVerificationToken']").val(),u="/api/Products/"+t;t&&$.ajax(u,{type:"GET",headers:{"X-XSRF-TOKEN":r},success:function(n){console.log(n);var u=$("#"+t+i),r=parseFloat(n.availableQuantity);r=r.toFixed(2);r=r.replace(".",",");u.html(r);n.avquantity<n.minimumPurchaseQuantity&&$("#"+t+"_btnCart").addClass("disabled");$("#cartDisplay").load("/AjaxContent/ShoppingCart")},error:function(n){console.log(n);marelibusoft.common.showModalAlert("alert","Verfügbaremege konnte nicht abgerufen werden!","warning");$("#cartDisplay").load("/AjaxContent/ShoppingCart");setTimeout(location.reload(),800)},contentType:"application/json",dataType:"json",timeout:6e4})}function deleteCartLine(n){var t=n,i=$("#cartid").html(),r="/api/ShoppingCartLines/"+t,u=$("input[name='__RequestVerificationToken']").val();document.getElementById(t+"_loader").style.display="block";$.ajax(r,{type:"DELETE",headers:{"X-XSRF-TOKEN":u},data:JSON.stringify({shoppingCartID:i,id:t}),success:function(n){console.log("on delete cart line: "+n);$("#cartDisplay").load("/AjaxContent/ShoppingCart");location.reload()},error:function(){$("#cartDisplay").load("/AjaxContent/ShoppingCart");marelibusoft.common.showModalAlert("alert","Beim löschen ist ein fehler aufgetreten!","danger");location.reload()},contentType:"application/json",dataType:"json",timeout:6e4})}function creatCart(){var t=$("#cartid").html(),i=$("input[name='__RequestVerificationToken']").val(),n;t||(n="/api/ShoppingCarts",$.ajax(n,{type:"POST",data:JSON.stringify({shoppingCartID:""}),success:function(n){var t=JSON.parse(n),i=$("#cartid").html(t.shoppingCartID);$("#cartCount").html(0)},error:function(){$("#cartDisplay").load("/AjaxContent/ShoppingCart");alert("error on creat cart!")},contentType:"application/json",dataType:"json",timeout:6e4}))}function onShipPriceChange(){var t=$("#total").html(),n,i;t=t.replace(",",".");n=$("#countries").val();n=n.replace(",",".");i=$("#shipPrice").html();i=i.replace(",",".");var r=parseFloat(t),u=parseFloat(i),f=parseFloat(n);r=r-u;r=r+f;r=r.toFixed(2);t=r.toLocaleString();t=t.replace(".",",");u=u.toFixed(2);i=u.toLocaleString();i=i.replace(".",",");f=f.toFixed(2);n=f.toLocaleString();n=n.replace(".",",");$("#shipPrice").html(n);$("#total").html(t)}function updateTotal(){var t=$("#total").html(),n=0,i=$("#shipPrice").html(),r;i=i.replace(",",".");r=parseFloat(i);$(".listprice").each(function(t){var i,r;console.log(t+": "+$(this).html());i=$(this).html();i=i.replace(",",".");r=parseFloat(i);n+=r});n+=r;n=n.toFixed(2);t=n.toLocaleString();t=t.replace(".",",");$("#total").html(t)}function checkIsQuantityAvailable(n,t){var s=$("#"+t+"_availableQuantity"),h=$("#"+n+"_quantity"),i=h.val(),r=s.html(),f=$("#"+n+"_startQuantity").html(),u,e,o;return(i=i.replace(",","."),r=r.replace(",","."),u=parseFloat(i),e=parseFloat(r),f&&(o=parseFloat(f.replace(",",".")),u-=o),u>e)?(marelibusoft.common.showModalAlert("alert","Die die eingegebene Megene &uuml;bersteigt die verf&uuml;gbare Menge!","danger"),!1):!0}if(!marelibusoft)var marelibusoft={};marelibusoft.cart||(marelibusoft.cart={});marelibusoft.cart.changedItems=[];