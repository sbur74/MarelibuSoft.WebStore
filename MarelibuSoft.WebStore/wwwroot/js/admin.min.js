if(!marelibusoft)var marelibusoft={};marelibusoft.admin||(marelibusoft.admin={});marelibusoft.admin.categoryIndexer=0;marelibusoft.admin.getCategories=function(){marelibusoft.admin.categoryIndexer++;$.ajax("/api/AdminCategories",{type:"GET",contentType:"application/json",dataType:"json",timeout:6e4,success:function(n){var t=n;marelibusoft.admin.renderCatgories(t)},error:function(){alert("fehler")}})};marelibusoft.admin.getCategorySubs=function(n){var t=n,i="/api/AdminCategorySubs/Category/"+t;$.ajax(i,{type:"GET",contentType:"application/json",dataType:"json",timeout:6e4,success:function(n){var t=n;marelibusoft.admin.renderSubs(t)},error:function(){alert("Fehler")}})};marelibusoft.admin.getCategoryDetails=function(n){var t=n,i="/api/AdminCategoryDetails/Sub/"+t;$.ajax(i,{type:"GET",contentType:"application/json",dataType:"json",timeout:6e4,success:function(n){var t=n;marelibusoft.admin.renderDetails(t)},error:function(n){alert(n)}})};marelibusoft.admin.renderCatgories=function(n){var t=marelibusoft.admin.categoryIndexer,r=$("#tableBody"),u=$("#categories_"+t),i="",f,e;u.length===0?(i+="<div id='row_"+t+"' class='row' ><div id='div_categories_"+t+"' class='col-sm-3'><select id='categories_"+t+"' class='form-control' onchange='marelibusoft.admin.getCategorySubs(this.value)'>",i+=marelibusoft.admin.renderOptions(n),i+="<\/select><\/div><div id='subs_"+t+"' class='col-sm-3'><\/div><div id='details_"+t+"' class='col-sm-3' ><\/div><div id='deleterow_"+t+"' class='col-sm-3'><button class='btn btn-danger' onclick='marelibusoft.admin.deleteRow(\"row_"+t+"\")'>Zeile L&ouml;schen<\/button><\/div><\/div>",r.append(i)):(u.empty(),i+=marelibusoft.admin.renderOptions(n),u.append(),f=$("#categorysubs_"+t),f.length>0&&(f.empty(),r.remove("#categorysubs_"+t)),e=$("#categorydetails_"+t),e.length>0&&(e.empty(),r.remove("#categorydetails_"+t)))};marelibusoft.admin.renderSubs=function(n){var t=marelibusoft.admin.categoryIndexer,f=$("#row_"+t),r=$("#categorysubs_"+t),i="",u;r.length===0?(i+="<select id='categorysubs_"+t+"' class='form-control' onchange='marelibusoft.admin.getCategoryDetails(this.value)'>",i+=marelibusoft.admin.renderOptions(n),i+="<\/select>",$("#subs_"+t).append(i)):(r.empty(),i+=marelibusoft.admin.renderOptions(n),r.append(i),u=$("#categorydetails_"+t),u.length>0&&(u.empty(),f.remove("#categorydetails_"+t)))};marelibusoft.admin.renderDetails=function(n){var i=marelibusoft.admin.categoryIndexer,u=$("#row_"+i),t="",r=$("#categorydetails_"+i);r.length===0?(t+="<select id='categorydetails_"+i+"' class='form-control'>",t+=marelibusoft.admin.renderOptions(n),t+="<\/select>",$("#details_"+i).append(t)):(r.empty(),t+=marelibusoft.admin.renderOptions(n),r.append(t))};marelibusoft.admin.renderOptions=function(n){var i="<option value=0>nicht Zugewiesen<\/option>",t;if(n)for(t=0;t<n.length;t++)i+="<option value='"+n[t].key+"'>"+n[t].value+"<\/option>";return i};marelibusoft.admin.cleareTable=function(){var n=$("#tableBody");n.empty();$("#messages").empty();marelibusoft.admin.categoryIndexer=0};marelibusoft.admin.deleteRow=function(n){$("#"+n).empty();var t=$("#tablebody");t.remove("#"+n);t.children("#tablebody").length===0&&(marelibusoft.admin.categoryIndexer=0)};marelibusoft.admin.submitTable=function(){for(var s=$("#productID"),i=s.val(),h=marelibusoft.admin.categoryIndexer+1,n=1;n<h;n++){var r=$("#categories_"+n),u=$("#categorysubs_"+n),f=$("#categorydetails_"+n),t=0,e=0,o=0;r.length>0&&(t=r.val());u.length>0&&(e=u.val());f.length>0&&(o=f.val());i>0&&t>0&&marelibusoft.admin.postAssignment(i,t,e,o)}};marelibusoft.admin.postAssignment=function(n,t,i,r){var u=JSON.stringify({productID:n,categoryID:t,categorySubID:i,categoryDetailID:r}),f=$("input[name='__RequestVerificationToken']").val();$.ajax("/api/AdminCategoryAssignments",{type:"POST",headers:{"X-XSRF-TOKEN":f},contentType:"application/json",dataType:"json",data:u,timeout:6e4,success:function(){$("#messages").empty().append('<div class="alert alert-success alert-dismissable fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;<\/a><strong>Erledigt!<\/strong> Artikel Kategorien Zuordnung angelegt<\/div>').fadeIn(3e3)},error:function(){$("#messages").empty().append('<div class="alert alert-danger alert-dismissable fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;<\/a><strong>Fehler!<\/strong> Fehler, bei der Anlage.<\/div>').fadeIn(3e3).fadeOut(1500)}})};marelibusoft.admin.calculateSecondBasePrice=function(){var t=parseFloat($("#basisPrice").val().replace(",",".")),i=parseFloat($("#productwith").val().replace(",",".")),r=1*i,n=t/r;n=n.toFixed(2);n=n.replace(".",",");$("#sbPrice").val(n);$("#myModal").modal("hide")};marelibusoft.admin.sendShippingMail=function(n){console.log("marelibusoft.admin.sendShippingMail -> orderid:"+n);var t=$("input[name='__RequestVerificationToken']").val()};$(".modal-wide").on("show.bs.modal",function(){var n=$(window).height()-200;$(this).find(".modal-body").css("max-height",n)});marelibusoft.admin.getVariants=function(){var n=$("input[name='__RequestVerificationToken']").val();$.ajax("/api/ProductVariants",{type:"GET",contentType:"application/json",headers:{"X-XSRF-TOKEN":n},dataType:"json",timeout:6e4,success:function(n){return n},error:function(){alert("Fehler")}})};marelibusoft.admin.getVariantOptions=function(){var n="/api/VariantOptionTemplates/variant/",i=$("input[name='__RequestVerificationToken']").val(),t=$("#selectVariant").find(":selected")[0].id,r=$("#selectVariant").find(":selected").text(),u=$("#selectVariant").find(":selected").attr("data-optionname");$("#variantNameAdd").val(r);$("#variantOptionNameAdd").val(u);console.log("selected variant:"+t);n+=t;$.ajax(n,{type:"GET",contentType:"application/json",headers:{"X-XSRF-TOKEN":i},dataType:"json",timeout:6e4,success:function(n){var i=n,t;if(i)for(t=0;t<i.length;t++)marelibusoft.admin.AddVariantOption("tblOpt",i[t].option)},error:function(){alert("Fehler")}})};marelibusoft.admin.getVariantCombiOptions=function(){var n="/api/VariantOptionTemplates/variant/",i=$("input[name='__RequestVerificationToken']").val(),t=$("#selectVariantCombi").find(":selected")[0].id,r=$("#selectVariantCombi").find(":selected").text(),u=$("#selectVariantCombi").find(":selected").attr("data-optionname");$("#combiVariantNameAdd").val(r);$("#combiVariantOptionNameAdd").val(u);console.log("selected variant:"+t);n+=t;$.ajax(n,{type:"GET",contentType:"application/json",headers:{"X-XSRF-TOKEN":i},dataType:"json",timeout:6e4,success:function(n){var i=n,t;if(i)for(t=0;t<i.length;t++)marelibusoft.admin.AddVariantOption("tblCombi",i[t].option)},error:function(){alert("Fehler")}})};marelibusoft.admin.cleareModalVariant=function(){marelibusoft.admin.variantOptionCount=0;marelibusoft.admin.variantCombiCount=0;$("#variantNameAdd").val("");$("#variantOptionNameAdd").val("");$("#combiVariantNameAdd").val("");$("#combiVariantOptionNameAdd").val("");$("#tblOpt").empty();$("tblCombi").empty()};marelibusoft.admin.variantOptionCount=0;marelibusoft.admin.variantCombiCount=0;marelibusoft.admin.AddVariantOption=function(n,t){var i=0,r,u;n==="tblOpt"?(marelibusoft.admin.variantOptionCount++,i=marelibusoft.admin.variantOptionCount):n==="tblCombi"&&(marelibusoft.admin.variantCombiCount++,i=marelibusoft.admin.variantCombiCount);t||(t="");r=$("#"+n);u="<div id='"+n+"_row_"+i+"' class='row'><div class='col-xs-9'><input id='"+n+"_optionId_"+i+"' class='form-control' type='text' value='"+t+"' /><\/div ><div class='col-xs-3'><a class='btn btn-danger' onclick='marelibusoft.admin.delteVariantRow(\""+n+'", '+i+")'><i class='fa fa-trash'><\/i><\/a><\/div ><\/div>";r.append(u);$("#"+n+"_optionId_"+i).focus()};marelibusoft.admin.delteVariantRow=function(n,t){var i="#"+n+"_row_"+t,r;$(i).empty();r=$("#"+n);r.remove(i)};marelibusoft.admin.saveVariantOnSubmit=function(){event.preventDefault();$(".marelibu-varinat-rows").each(function(){var n=$(this).data("variant-id");console.log(n);marelibusoft.admin.saveVariant(n)})};marelibusoft.admin.saveVariant=function(n){var t=n;$("#variantTableBodyId_"+t+" > tr").each(function(){var n=$(this).data("option-id");marelibusoft.admin.saveOption(t,n)})};marelibusoft.admin.createVariants=function(){var c=$("#ProductID").val(),f=$("#variantNameAdd").val(),e=$("#variantOptionNameAdd").val(),p=$("#combiVariantNameAdd").val(),w=$("#combiVariantOptionNameAdd").val(),l=$("#copyTemplate"),i=!1,a=$("#isAbsolutelyNecessary"),o=!1,v=$("#tblOpt"),y=$("#tblCombi"),s=v.find("input"),h=y.find("input"),b=marelibusoft.admin.variantOptionCount,k=marelibusoft.admin.variantCombiCount,r=[],u=[],n,t;a.prop("checked")&&(o=!0);l.prop("checked")&&(i=!0);h.length>0?$.each(s,function(n,t){$.each(h,function(n,f){var e={},o;e.option=t.value;e.quantity=15;e.price=0;e.combi=f.value;r.push(e);i&&(o={},o.option=t.value,u.push(o))})}):$.each(s,function(n,t){var f={},e;f.option=t.value;f.quantity=15;f.price=0;f.combi="";r.push(f);i&&(e={},e.option=t.value,u.push(e))});n={};n.Name=f;n.OptionName=e;n.Options=r;n.IsAbsolutelyNecessary=o;n.ProductId=c;i&&(t={},t.Name=f,t.OptionName=e,t.VariantOptionTemplates=u,marelibusoft.admin.postVariantTemplate(t));marelibusoft.admin.postVariant(n);$("#variantModal").modal("hide");location.reload()};marelibusoft.admin.putVariantIsAbsolutelyNecessary=function(n){var u=$("#isAbsolutelyNecessary_"+n),t=!1,i,r;u.prop("checked")&&(t=!0);i="/api/ProductVariants/isNecessary/"+n;r=$("input[name='__RequestVerificationToken']").val();$.ajax(i,{headers:{"X-XSRF-TOKEN":r},type:"PUT",contentType:"application/json",data:JSON.stringify({isActive:t}),dataType:"json",timeout:6e4,success:function(n){var t=n;$(".new-product").length>0&&location.reload()},error:function(){alert("Fehler")}})};marelibusoft.admin.postVariant=function(n){var t=$("input[name='__RequestVerificationToken']").val(),i=n;$.ajax("/api/ProductVariants",{headers:{"X-XSRF-TOKEN":t},type:"POST",contentType:"application/json",data:JSON.stringify(i),dataType:"json",timeout:6e4,success:function(n){var t=n;console.log(t);$(".new-product").length>0&&location.reload()},error:function(){alert("Fehler")}})};marelibusoft.admin.postVariantTemplate=function(n){var t=$("input[name='__RequestVerificationToken']").val(),i=n;$.ajax("/api/VariantTemplates",{headers:{"X-XSRF-TOKEN":t},type:"POST",contentType:"application/json",data:JSON.stringify(i),dataType:"json",timeout:6e4,success:function(){console.log("Variante angelegt")},error:function(){alert("Fehler")}})};marelibusoft.admin.deleteProductVariant=function(n){var t="/api/ProductVariants/"+n,i=$("input[name='__RequestVerificationToken']").val();$.ajax(t,{headers:{"X-XSRF-TOKEN":i},type:"DELETE",contentType:"application/json",dataType:"json",timeout:6e4,success:function(){location.reload()},error:function(){alert("Fehler")}})};marelibusoft.admin.addOption=function(n){var t={Opiton:"",Qunatity:1,Price:0,ProductVariantID:n},i=$("input[name='__RequestVerificationToken']").val();$.ajax("/api/ProductVariantOptions",{headers:{"X-XSRF-TOKEN":i},type:"POST",contentType:"application/json",data:JSON.stringify(t),dataType:"json",timeout:6e4,success:function(){location.reload()},error:function(){alert("Fehler")}})};marelibusoft.admin.saveOption=function(n,t){var f=$("#option_"+t).val(),e=marelibusoft.common.str2Float($("#quatity_"+t).val()),o=marelibusoft.common.str2Float($("#price_"+t).val()),i=!1,r,u;$("#isNotShown_"+t).prop("checked")&&(i=!0);r="/api/ProductVariantOptions/"+t;u=$("input[name='__RequestVerificationToken']").val();$.ajax(r,{headers:{"X-XSRF-TOKEN":u},type:"PUT",contentType:"application/json",data:JSON.stringify({id:t,option:f,quantity:e,price:o,isNotShown:i,productVariantID:n}),dataType:"json",timeout:6e4,success:function(){console.log("geändert angelegt")},error:function(){alert("Fehler")}})};marelibusoft.admin.deleteOption=function(n,t){var i="/api/ProductVariantOptions/"+t,r=$("input[name='__RequestVerificationToken']").val();$.ajax(i,{headers:{"X-XSRF-TOKEN":r},type:"DELETE",contentType:"application/json",data:JSON.stringify({id:t,productVariantID:n}),dataType:"json",timeout:6e4,success:function(){console.log("gelöscht");location.reload()},error:function(){alert("Fehler")}})};marelibusoft.admin.addCombiVariant=function(){var n=$("containerCombi");n.append("<a class='btn btn-success' onclick='marelibusoft.admin.AddVariantOption('tableBodyVariantCombi')'><i class='fa fa - plus - circle'><\/i> Option hinzuf& uuml; gen<\/a ><div id = 'tableCombi class='table'><div class='row'><div class='col-xs-3'><label class='control-label'>Wert<\/label><\/div><div class='col-xs-3'><label class='control-label'>Menge<\/label><\/div><div class='col-xs-3'><label class='control-label'>Preis<\/label><\/div><div class='col-xs-'><label class='control-label'>Aktionen<\/label><\/div><\/div ><div id='tableBodyVariantCombi'><\/div><\/div >")};